<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Smart Payroll Manager</title>
  <!-- jsPDF for PDF payslip generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
  <style>
    :root {
      --bg: #f5f7fb;
      --card: #ffffff;
      --text: #1f2937;
      --muted: #6b7280;
      --brand: #2563eb;
      --brand-2: #0ea5e9;
      --success: #059669;
      --danger: #dc2626;
      --border: #e5e7eb;
    }
    /* Dark mode tokens */
    .dark {
      --bg: #0b1220;
      --card: #0f172a;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --brand: #3b82f6;
      --brand-2: #22d3ee;
      --success: #10b981;
      --danger: #ef4444;
      --border: #1f2937;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 10% 10%, rgba(37,99,235,.15), transparent 60%),
                  radial-gradient(1000px 600px at 90% 20%, rgba(14,165,233,.12), transparent 55%),
                  var(--bg);
      color: var(--text);
    }

    .container {
      max-width: 1100px;
      margin: 24px auto;
      padding: 16px;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 16px;
    }

    .title {
      font-size: clamp(1.4rem, 1.2rem + 1vw, 2rem);
      line-height: 1.2;
      margin: 0;
    }

    .muted { color: var(--muted); }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(2, 6, 23, 0.08);
      padding: 18px;
    }

    .grid {
      display: grid;
      grid-template-columns: 1.25fr 1fr;
      gap: 16px;
    }

    .section-title { font-weight: 700; margin: 0 0 12px; }

    .form { display: grid; gap: 12px; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .row-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }

    label { font-size: .9rem; }

    input, select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: transparent;
      color: var(--text);
      outline: none;
    }
    input:focus, select:focus { border-color: var(--brand); box-shadow: 0 0 0 3px rgba(37,99,235,.15); }

    .btns { display: flex; flex-wrap: wrap; gap: 10px; }
    .btn {
      padding: 10px 14px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: linear-gradient(135deg, var(--brand), var(--brand-2));
      color: white;
      cursor: pointer;
      font-weight: 600;
    }
    .btn.secondary { background: transparent; color: var(--text); }
    .btn.warn { background: linear-gradient(135deg, #f43f5e, #ef4444); color: white; }
    .btn.outline { background: transparent; border-color: var(--brand); color: var(--brand); }

    .error { color: var(--danger); font-weight: 700; margin-top: 6px; min-height: 22px; }

    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px 12px; border-bottom: 1px dashed var(--border); text-align: left; }
    th { font-size: .9rem; color: var(--muted); }
    tfoot td { font-weight: 700; }

    .history { max-height: 220px; overflow: auto; border: 1px solid var(--border); border-radius: 12px; }
    .pill { display: inline-block; padding: 4px 8px; border-radius: 999px; background: rgba(37,99,235,.12); color: var(--brand); font-weight: 700; font-size: .8rem; }

    /* Responsive */
    @media (max-width: 960px) {
      .grid { grid-template-columns: 1fr; }
    }
    @media (max-width: 560px) {
      .row, .row-3 { grid-template-columns: 1fr; }
      .btns { flex-direction: column; }
      .header { flex-direction: column; align-items: flex-start; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1 class="title">Smart Payroll Manager</h1>
        <div class="muted">Salary breakdown ‚Ä¢ Tax & deductions ‚Ä¢ PDF payslip ‚Ä¢ Dark mode</div>
      </div>
      <div class="btns">
        <button id="toggleDark" class="btn outline" title="Toggle dark mode">üåô / ‚òÄÔ∏è</button>
        <button id="resetAll" class="btn secondary" title="Reset form">Reset</button>
      </div>
    </div>

    <div class="grid">
      <!-- Left: Form -->
      <div class="card">
        <h2 class="section-title">Employee & Salary Inputs</h2>
        <div class="form">
          <div class="row">
            <div>
              <label>Employee Name</label>
              <input id="empName" placeholder="e.g., Divyanshu Rautela" />
            </div>
            <div>
              <label>Employee ID</label>
              <input id="empId" placeholder="e.g., NITJ-TE-023" />
            </div>
          </div>
          <div class="row">
            <div>
              <label>Month</label>
              <select id="month">
                <option>January</option>
                <option>February</option>
                <option>March</option>
                <option>April</option>
                <option>May</option>
                <option>June</option>
                <option>July</option>
                <option>August</option>
                <option>September</option>
                <option>October</option>
                <option>November</option>
                <option>December</option>
              </select>
            </div>
            <div>
              <label>Pay Date</label>
              <input id="payDate" type="date" />
            </div>
          </div>

          <h3 class="section-title" style="margin-top:8px">Earnings</h3>
          <div class="row-3">
            <div>
              <label>Basic (‚Çπ)</label>
              <input id="basic" type="number" placeholder="e.g., 30000" />
            </div>
            <div>
              <label>HRA (% of Basic)</label>
              <input id="hraPct" type="number" placeholder="e.g., 40" />
            </div>
            <div>
              <label>Other Allowances (‚Çπ)</label>
              <input id="allow" type="number" placeholder="e.g., 5000" />
            </div>
          </div>
          <div class="row">
            <div>
              <label>Bonus (‚Çπ)</label>
              <input id="bonus" type="number" placeholder="e.g., 2000" />
            </div>
            <div>
              <label>Overtime (‚Çπ)</label>
              <input id="ot" type="number" placeholder="e.g., 1500" />
            </div>
          </div>

          <h3 class="section-title" style="margin-top:8px">Deductions</h3>
          <div class="row-3">
            <div>
              <label>PF (% of Basic)</label>
              <input id="pfPct" type="number" placeholder="e.g., 12" />
            </div>
            <div>
              <label>Professional Tax (‚Çπ)</label>
              <input id="ptax" type="number" placeholder="e.g., 200" />
            </div>
            <div>
              <label>TDS / Income Tax (% of Gross)</label>
              <input id="tdsPct" type="number" placeholder="e.g., 5" />
            </div>
          </div>

          <div class="btns" style="margin-top:8px">
            <button id="calc" class="btn">Calculate</button>
            <button id="download" class="btn" title="Download payslip PDF">Download Payslip</button>
          </div>
          <div id="err" class="error"></div>
        </div>
      </div>

      <!-- Right: Results -->
      <div class="card">
        <h2 class="section-title">Breakdown & Results</h2>
        <table>
          <tbody id="resultsBody">
            <tr><th>Basic</th><td id="rBasic">‚Çπ0</td></tr>
            <tr><th>HRA</th><td id="rHra">‚Çπ0</td></tr>
            <tr><th>Other Allowances</th><td id="rAllow">‚Çπ0</td></tr>
            <tr><th>Bonus</th><td id="rBonus">‚Çπ0</td></tr>
            <tr><th>Overtime</th><td id="rOt">‚Çπ0</td></tr>
            <tr><th><span class="pill">Gross Earnings</span></th><td id="rGross">‚Çπ0</td></tr>
            <tr><th>PF</th><td id="rPf">‚Çπ0</td></tr>
            <tr><th>Professional Tax</th><td id="rPtax">‚Çπ0</td></tr>
            <tr><th>TDS / Income Tax</th><td id="rTds">‚Çπ0</td></tr>
          </tbody>
          <tfoot>
            <tr><td>Total Deductions</td><td id="rDeduct">‚Çπ0</td></tr>
            <tr><td>Net Pay (in hand)</td><td id="rNet" style="font-size:1.15rem">‚Çπ0</td></tr>
          </tfoot>
        </table>
      </div>
    </div>

    <!-- History -->
    <div class="card" style="margin-top:16px;">
      <h2 class="section-title">Payslip History</h2>
      <div class="history">
        <table style="width:100%">
          <thead>
            <tr><th>Date</th><th>Employee</th><th>Month</th><th>Net Pay</th></tr>
          </thead>
          <tbody id="historyBody"></tbody>
        </table>
      </div>
      <div class="btns" style="margin-top:12px">
        <button id="clearHistory" class="btn warn">Clear History</button>
      </div>
    </div>
  </div>

  <script>
    // Helpers
    const fmtINR = (n) => new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 2 }).format(Number(n) || 0);
    const getVal = (id) => Number(document.getElementById(id).value) || 0;

    // Elements
    const empNameEl = document.getElementById('empName');
    const empIdEl   = document.getElementById('empId');
    const monthEl   = document.getElementById('month');
    const payDateEl = document.getElementById('payDate');

    const basicEl   = document.getElementById('basic');
    const hraPctEl  = document.getElementById('hraPct');
    const allowEl   = document.getElementById('allow');
    const bonusEl   = document.getElementById('bonus');
    const otEl      = document.getElementById('ot');

    const pfPctEl   = document.getElementById('pfPct');
    const ptaxEl    = document.getElementById('ptax');
    const tdsPctEl  = document.getElementById('tdsPct');

    const rBasic = document.getElementById('rBasic');
    const rHra   = document.getElementById('rHra');
    const rAllow = document.getElementById('rAllow');
    const rBonus = document.getElementById('rBonus');
    const rOt    = document.getElementById('rOt');
    const rGross = document.getElementById('rGross');
    const rPf    = document.getElementById('rPf');
    const rPtax  = document.getElementById('rPtax');
    const rTds   = document.getElementById('rTds');
    const rDeduct= document.getElementById('rDeduct');
    const rNet   = document.getElementById('rNet');

    const err    = document.getElementById('err');

    const calcBtn = document.getElementById('calc');
    const dlBtn   = document.getElementById('download');
    const resetAll= document.getElementById('resetAll');
    const toggleDark = document.getElementById('toggleDark');

    const historyBody = document.getElementById('historyBody');
    const clearHistory = document.getElementById('clearHistory');

    // Prefill defaults
    const todayISO = new Date().toISOString().slice(0,10);
    payDateEl.value = todayISO;
    hraPctEl.value = 40;
    pfPctEl.value = 12;
    ptaxEl.value = 200;
    tdsPctEl.value = 5;

    // Dark mode toggle + persist
    const applyTheme = () => {
      if (localStorage.getItem('theme') === 'dark') document.documentElement.classList.add('dark');
      else document.documentElement.classList.remove('dark');
    };
    applyTheme();
    toggleDark.addEventListener('click', () => {
      const next = localStorage.getItem('theme') === 'dark' ? 'light' : 'dark';
      localStorage.setItem('theme', next);
      applyTheme();
    });

    // Load history
    function loadHistory() {
      historyBody.innerHTML = '';
      const items = JSON.parse(localStorage.getItem('payslips') || '[]');
      for (const it of items) {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${it.date}</td><td>${it.name} (${it.id})</td><td>${it.month}</td><td>${fmtINR(it.net)}</td>`;
        historyBody.appendChild(tr);
      }
    }
    loadHistory();

    // Validation
    function validate() {
      err.textContent = '';
      if (!empNameEl.value.trim()) return err.textContent = 'Please enter employee name', false;
      if (!empIdEl.value.trim())   return err.textContent = 'Please enter employee ID', false;
      if (getVal('basic') <= 0)    return err.textContent = 'Basic must be greater than 0', false;
      return true;
    }

    // Calculate
    function calculate() {
      if (!validate()) return;

      const basic = getVal('basic');
      const hra   = basic * (getVal('hraPct') / 100);
      const allow = getVal('allow');
      const bonus = getVal('bonus');
      const ot    = getVal('ot');

      const gross = basic + hra + allow + bonus + ot;

      const pf    = basic * (getVal('pfPct') / 100);
      const ptax  = getVal('ptax');
      const tds   = gross * (getVal('tdsPct') / 100);
      const deductions = pf + ptax + tds;
      const net   = gross - deductions;

      // Render
      rBasic.textContent = fmtINR(basic);
      rHra.textContent   = fmtINR(hra);
      rAllow.textContent = fmtINR(allow);
      rBonus.textContent = fmtINR(bonus);
      rOt.textContent    = fmtINR(ot);
      rGross.textContent = fmtINR(gross);
      rPf.textContent    = fmtINR(pf);
      rPtax.textContent  = fmtINR(ptax);
      rTds.textContent   = fmtINR(tds);
      rDeduct.textContent= fmtINR(deductions);
      rNet.textContent   = fmtINR(net);

      // Store for PDF
      const snapshot = { basic, hra, allow, bonus, ot, gross, pf, ptax, tds, deductions, net };
      localStorage.setItem('lastCalc', JSON.stringify(snapshot));

      // Save history entry
      const item = {
        date: new Date(payDateEl.value || new Date()).toLocaleDateString('en-IN'),
        name: empNameEl.value.trim(),
        id:   empIdEl.value.trim(),
        month: monthEl.value,
        net
      };
      const list = JSON.parse(localStorage.getItem('payslips') || '[]');
      list.unshift(item);
      localStorage.setItem('payslips', JSON.stringify(list.slice(0, 50))); // keep last 50
      loadHistory();
    }

    calcBtn.addEventListener('click', calculate);

    // Reset
    resetAll.addEventListener('click', () => {
      document.querySelectorAll('input').forEach(i => i.value = '');
      hraPctEl.value = 40; pfPctEl.value = 12; ptaxEl.value = 200; tdsPctEl.value = 5;
      payDateEl.value = new Date().toISOString().slice(0,10);
      err.textContent = '';
      ['rBasic','rHra','rAllow','rBonus','rOt','rGross','rPf','rPtax','rTds','rDeduct','rNet']
        .forEach(id => document.getElementById(id).textContent = '‚Çπ0');
    });

    clearHistory.addEventListener('click', () => {
      if (confirm('Clear saved payslip history?')) {
        localStorage.removeItem('payslips');
        loadHistory();
      }
    });

    // PDF payslip
    dlBtn.addEventListener('click', () => {
      if (!validate()) return;
      // Ensure latest calc
      if (!document.getElementById('rNet').textContent || document.getElementById('rNet').textContent === '‚Çπ0') {
        calculate();
      }
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      const line = (y) => { doc.setDrawColor(180); doc.line(14, y, 196, y); };

      doc.setFontSize(16); doc.text('Payslip', 14, 16);
      doc.setFontSize(10); doc.text(`Pay Date: ${new Date(payDateEl.value || new Date()).toLocaleDateString('en-IN')}`, 160, 16, { align: 'right' });
      line(18);

      doc.setFontSize(12);
      doc.text(`Employee: ${empNameEl.value}  (ID: ${empIdEl.value})`, 14, 28);
      doc.text(`Month: ${monthEl.value}`, 14, 35);

      line(38);
      doc.setFontSize(12); doc.text('Earnings', 14, 46);
      doc.setFontSize(11);
      const last = JSON.parse(localStorage.getItem('lastCalc') || '{}');
      const y0 = 52;
      let y = y0;
      const rows = [
        ['Basic', last.basic],
        ['HRA', last.hra],
        ['Other Allowances', last.allow],
        ['Bonus', last.bonus],
        ['Overtime', last.ot],
        ['Gross', last.gross]
      ];
      rows.forEach(r => { doc.text(r[0], 16, y); doc.text(fmtINR(r[1]), 180, y, { align: 'right' }); y += 7; });

      line(y + 2);
      y += 10; doc.setFontSize(12); doc.text('Deductions', 14, y); y += 6; doc.setFontSize(11);
      const rowsD = [
        ['PF', last.pf],
        ['Professional Tax', last.ptax],
        ['TDS / Income Tax', last.tds],
        ['Total Deductions', last.deductions]
      ];
      rowsD.forEach(r => { doc.text(r[0], 16, y); doc.text(fmtINR(r[1]), 180, y, { align: 'right' }); y += 7; });

      line(y + 2);
      y += 12; doc.setFontSize(13); doc.text('Net Pay (in hand)', 14, y);
      doc.setFontSize(13); doc.text(fmtINR(last.net), 180, y, { align: 'right' });

      y += 14; doc.setFontSize(10); doc.setTextColor(120);
      doc.text('This is a system-generated payslip.', 14, y);

      const fileName = `Payslip_${empNameEl.value.replace(/\s+/g,'_')}_${monthEl.value}.pdf`;
      doc.save(fileName);
    });
  </script>
</body>
</html>